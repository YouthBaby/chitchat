<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>群聊</title>
</head>

<body>
    <div style="float: left; width: 30%">
        发给
        <input type="text" id="nameinput">
        <button id="adduser">添加用户</button>
        <input type="text" id="username">
        <hr> 私聊
        <input type="text" id="msginput">
        <button id="sendmsg">发送</button>
    </div>
    <div style="float: left; width: 65%" id="chatbox">

    </div>
</body>
<script src="/socket.io/socket.io.js"></script>
<script>  
    let socket = io.connect('http://localhost:3000')

    let sendmsg = document.getElementById('sendmsg')
    let adduser = document.getElementById('adduser')
    let msgInput = document.getElementById('msginput')
    let nameInput = document.getElementById('nameinput')
    let username = document.getElementById('username')

    adduser.addEventListener('click', () => {
        let name = username.value
        socket.emit('adduser', { name })
    })
    sendmsg.addEventListener('click', () => {
        let from = username.value
        let to = nameInput.value
        let msg = msgInput.value
        socket.emit('compose', { from, to, msg })
    })

    socket.on('receiveMsg', (data) => {
        let chatBox = document.getElementById('chatbox')
        let div = document.createElement('div')
        div.innerHTML = `${data.from}: ${data.msg}`
        chatBox.appendChild(div)
    })

    /**  
     * 下面写两个分组的共同的方法  
     */
    // let chat = (socket) => {
    //     let btn = document.getElementById('sendmsg')
    //     let msgInput = document.getElementById('msginput')
    //     btn.addEventListener('click', () => {
    //         let msg = msgInput.value
    //         let data = { msg: msg }
    //         socket.emit('sendMsg', data)
    //     });
    //     socket.on('receiveMsg', (data) => {
    //         let chatBox = document.getElementById('chatbox')
    //         let div = document.createElement('div')
    //         div.innerHTML = `${data.id}: ${data.msg}`
    //         chatBox.appendChild(div)
    //     })
    // }
    // function joinFirst() {
    //     chat(group1)
    // }
    // function joinSecond() {
    //     chat(group2)
    // }
    // sendImg.addEventListener('click', () => {
    //     let Imginput = document.getElementById('tupian')
    //     let file = Imginput.files[0]       //得到该图片  
    //     let formData = new FormData()
    //     formData.append(file.name, file)
    //     let xhr = new XMLHttpRequest()
    //     xhr.open('POST', '/sendimg', true)
    //     xhr.send(formData)
    //     xhr.onreadystatechange = () => {
    //         if (xhr.readyState === 4 && xhr.status === 200) {
    //             console.log('success');
    //             let data = { img: xhr.responseText }
    //             socket.emit('sendImg', data)
    //         }
    //     }
    // })
    // socket.on('receiveImg', (data) => {
    //     let ImgDIV = document.createElement('div')
    //     ImgDIV.innerHTML = `<div>${data.id}: <img src=/images/${data.img}></div>`
    //     showbox.appendChild(ImgDIV)
    // })  
</script>
</body>

</html>